version: "2.1"

services:
  duplicati:
    image: linuxserver/duplicati
    container_name: duplicati
    environment:
      # The user and process run as ROOT to allow backup of all files without any difficulties (eg LetsEncrypt certs)
      - PUID=0
      - PGID=0
      - TZ=Australia/Perth
      # Optional Duplicati CLI arguments:
      #- CLI_ARGS=
    volumes:
      # Duplicati persistent volume for its configuration data:
      - duplicati-app-data:/config
      # Backup location for tar.gz (etc) files to be stored - did not use Ubuntu system default of 'var/backups' as this already has files in it, bind mount:
      - var/duplicati-backups:/backups
      # Backup sources - root dir, another bind mount:
      - var/duplicati-sources:/source
      # Backup sources - Nginx PM data:
      - nginxpm-data:/source/nginxpm-data
      # Backup sources - Nginx LetsEncrypt data:
      - nginxpm-letsencrypt:/source/nginxpm-letsencrypt
    ports:
      - 8200:8200
    restart: unless-stopped

volumes:
  # Each folder referenced in the Services config (above) for Duplicati must be sourced here:
  duplicati-app-data:
    external: true
    name: duplicati-app-data
  nginxpm-data:
    external: true
    name: nginxpm-data
  nginxpm-letsencrypt:
    external: true
    name: nginxpm-letsencrypt